#specimens
  - if labs.any?
    - labs.each do |lab|
      .card.specimen
        .card-header{ class: lab.retrieved? || lab.discarded? ? 'collapsed' : '', data: { toggle: 'collapse', target: ".specimen-#{lab.id}-collapse" } }
          .row
            .col-12.col-sm-10.d-flex.flex-column.justify-content-between
              %h4.d-flex.w-100.font-weight-bold.mb-2.mb-sm-0
                %span
                  = icon('fas', 'caret-down mr-2 mt-0 mt-sm-1')
                %span.mt-0.mt-sm-1
                  = t('labs.table.header', id: lab.id, source: lab.source.value, accession_number: lab.accession_number)
                .d-none.d-sm-inline-block
                  = lab_status_context(lab)
            .col-12.col-sm-2.d-flex.flex-wrap.align-items-start.justify-content-between.justify-content-sm-end
              %h4.d-block.d-sm-none.mb-0
                = lab_status_context(lab)
              = lab_actions(lab)
        .collapse{ class: ["specimen-#{lab.id}-collapse", lab.retrieved? || lab.discarded? ? '' : 'show'] }
          .card-body
            .d-flex.flex-wrap.justify-content-between
              %h4
                %small.text-muted<
                  = lab_patient_information(lab)
              - if lab.releaser.present?
                %h4.text-right
                  %small.text-muted<
                    = lab_releaser_information(lab)
            - if lab.available?
              - if lab.line_items.any?
                %h4.card-title.font-weight-bold
                  = t('labs.table.requests.header')
                - lab.line_items.eager_load(:labs).preload(sparc_request: [:protocol, :primary_pi]).each do |line_item|
                  .row.specimen-line-item
                    .col-sm-4.col-12.d-flex
                      .d-flex.align-items-start.mr-2
                        = release_lab_button(lab, line_item)
                      .d-flex.flex-column.mr-2
                        %h5.font-weight-bold.mb-0
                          = request_title_display(line_item.sparc_request)
                        %h5.text-muted.mb-0
                          %small
                            = requester_display(line_item.sparc_request)
                    .col-sm-8.col-12.pl-sm-0
                      .d-flex.flex-column.flex-fill
                        .d-flex.justify-content-between.order-last.order-sm-first
                          .w-50
                            - if lab.group.process_sample_size?
                              = lab_sample_size_display(line_item)
                          .w-50.d-flex.justify-content-end
                            %p.mb-0
                              = request_duration_display(line_item.sparc_request)
                        = render 'line_items/progress_bar', li: line_item
            - else
              - if lab.line_item.present?
                %h4.card-title.font-weight-bold
                  = t('labs.table.released.header')
                .row.specimen-line-item
                  .col-sm-4.col-12.d-flex
                    .d-flex.flex-column.mr-2
                      %h5.font-weight-bold.mb-0
                        = request_title_display(lab.sparc_request)
                      %h5.text-muted.mb-0
                        %small
                          = requester_display(lab.sparc_request)
                  .col-sm-8.col-12.pl-sm-0
                    .d-flex.flex-column.flex-fill
                      .d-flex.justify-content-between.order-last.order-sm-first
                        .w-50
                          - if lab.group.process_sample_size?
                            = lab_sample_size_display(lab.line_item)
                        .w-50.d-flex.justify-content-end
                          %p.mb-0
                            = request_duration_display(lab.sparc_request)
                      = render 'line_items/progress_bar', li: lab.line_item
    = will_paginate labs, renderer: WillPaginate::ActionView::BootstrapLinkRenderer, list_classes: %w(pagination justify-content-end mb-0)
  - else
    .card
      .card-body
        %p.text-center.mb-0
          = t(:constants)[:no_records]
